<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Maze</title>
<link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACAAQAAAADrRVxmAAAACXBIWXMAAAMfAAADHwHmEQywAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAVZJREFUSMfd1EuOwyAMAFAQ0rAZNUfIUTga5GbsZtkrcINhyQLBYMgHG6ZddJcoSpOXDzY2ZZls7F5Q9iAzhyu/XsAomCm4AdRHYPUUNAH7GTgdRbZd+k6FCZgGZQPw/DV45dgIWw+rc3rrRvGrHcBrjmDzqocAIBCIsr+ERcYFwYNAfMj0QPC9pC+JIWNgpfJvQGXTQwJYCFgMegSHIWPIA/DaplO49UIuEy7qUR5gWakJHA+oXZhNZYBYQNQnlgaBKSthrRjRwJXfcu+ZA28A5fmF7yXWwKg+BgB9AJyxPtgGib8FQSCKjEcZQR7XqUUaTgiCgJME9vRPMEwREJk+McCKodUBDUvjiDTSfU4v2NPvwCqc7QHif3Bz6Ga9vZIYga5yVs9rO1Qf+uOnSw6yhnKu2Yurx+C/Ru8TVLuQl9HPtmx9CqCvTlYwxxz3eqhv3Htl/wEokJpySHNGkgAAAABJRU5ErkJggg==">
<!-- Copyright 2020 Hal Canary. ALL RIGHTS RESERVED. -->
<style>
svg line {
    stroke: black;
    stroke-width: 1;
    stroke-linecap: round;
    fill: none;
}
svg { margin: 0; }
@page { margin: 0.5in 0.5in 0.25in 0.5in; }
@media print {
    body { margin: 0; padding: 0; }
}
</style>
<script>
window.addEventListener('load', () => {
    const match = /\?size=([0-9]*)/.exec(window.location.search);
    const w = match === null ? 20 : match[1];
    const h = Math.floor(w * 4 / 3);
    const scale = 690 / w;
    const up = 1 << 0;
    const down = 1 << 1;
    const left = 1 << 2;
    const right = 1 << 3;
    let maze = new Array(w * h).fill(0);
    let stack = [];
    const addToStack = (x, y) => {
        if (x > 0) { stack.push([ x, y, x - 1, y, left ]); }
        if (y > 0) { stack.push([ x, y, x, y - 1, up   ]); }
        if (x + 1 < w) { stack.push([ x, y, x + 1, y, right ]); }
        if (y + 1 < h) { stack.push([ x, y, x, y + 1, down  ]); }
    };
    const getRandom = (a) => {
        const l = a.length;
        const i = Math.floor(Math.random() * l);  
        const r = a[i];
        a[i] = a[l - 1];
        a.pop();
        return r;
    }
    addToStack(0, 0);
    while (stack.length > 0) {
        let [x, y, nx, ny, dir] = getRandom(stack);
        let n = nx + w * ny;
        if (maze[n] != 0) {
            continue;
        }
        let p = x + w * y;
        switch (dir) {
            case up:
                maze[p] |= up;
                maze[n] |= down;
                break;
            case down:
                maze[p] |= down;
                maze[n] |= up;
                break;
            case left:
                maze[p] |= left;
                maze[n] |= right;
                break;
            case right:
                maze[p] |= right;
                maze[n] |= left;
                break;
        }
        addToStack(nx, ny); 
    };
    const s = 32;
    lines = [];
    for (let y = 0; y < h; ++y) {
        for (let x = 0; x < w; ++x) {
           let v = maze[x + y * w];
           if (x < w - 1 && (v & right) == 0) {
                lines.push([x + 1, y, x + 1, y + 1]);
           }
           if (y < h - 1 && (v & down) == 0) {
                lines.push([x, y + 1, x + 1, y + 1]);
           }
        }  
    }
    lines.push([0, 0, 0, h]);
    lines.push([1, 0, w, 0]);
    lines.push([0, h, w - 1, h]);
    lines.push([w, 0, w, h]);
    var svg = document.getElementById('s');
    var g = document.createElementNS("http://www.w3.org/2000/svg", "g");
    g.setAttribute('transform', `scale(${scale/10} ${scale/10})`);
    lines.forEach(([x1, y1, x2, y2]) => {
        var l = document.createElementNS("http://www.w3.org/2000/svg", "line");
        l.setAttribute('x1', x1 * 10);
        l.setAttribute('y1', y1 * 10);
        l.setAttribute('x2', x2 * 10);
        l.setAttribute('y2', y2 * 10);
        g.appendChild(l);
    });
    svg.appendChild(g);
});
</script>
</head>
<body>
<svg xmlns="http://www.w3.org/2000/svg"
     xmlns:xlink="http://www.w3.org/1999/xlink" 
     viewBox="-1 -1 691 921"
     preserveAspectRatio="xMidYMid meet"
     id='s'>
</svg>
</body>
</html>
